# MIUI骁龙845调度
本模块通过深度优化CPU调度策略和系统资源管理，为骁龙845设备提供第三方动态性能调校方案。基于系统级参数调整，实现屏幕状态感知的智能功耗控制，并提供多模式性能配置选择。代码遵循**GNU GPL 3.0协议**。

---

## 核心功能
### 1. **动态屏幕感知调度**
- **多层检测机制**：结合`dumpsys`命令和背光亮度文件检测屏幕状态，兼容不同厂商的硬件路径
- **后台守护进程**：模块检测屏幕状态时以最低优先级运行，避免过分占用系统资源

### 2. **息屏深度省电模式**
息屏状态下：
- **核心休眠**：关闭大核集群（CPU4-7）的物理供电
- **频率管控**：
  - 小核集群（CPU0-3）最高频率限制为902MHz
  - 大核集群完全禁用
- **IO优化**：切换为`noop`调度算法减少磁盘活动
- **性能限制**：通过`msm_performance`强制限制CPU频率
- **加速禁用**：关闭触控/输入事件触发的瞬时加速

### 3. **多模式性能配置**
支持4种可选模式：
| 模式        | 小核最高频率 | 大核最高频率 | 调度阈值 | 适用场景               |
|-------------|--------------|--------------|----------|------------------------|
| **PowerSave** | 1.68GHz       | 1.88GHz       | 90%      | 极致续航               |
| **Balance**  | 2.0GHz        | 2.4GHz        | 85%      | 日常使用（默认模式）   |
| **Performance** | 全开        | 全开          | 低延迟   | 游戏/渲染等高性能需求 |
| **Fast**     | 优化瞬时响应  | 智能动态调节  | 高灵敏度 | 需要快速响应的场景     |

### 4. **智能参数恢复机制**
- **模式优先原则**：从息屏省电模式退出时加载用户最后选择的模式配置
- **防冲突设计**：
  - 初始化时保存原始参数作为基线
  - 支持与第三方调度模块共存（需自行调整权限）
- **安全写入**：所有系统文件操作包含错误处理和权限验证

---

# 安装与使用
## 安装步骤
1. 确保设备已Root并安装Magisk（建议v19+稳定版）
2. 下载模块ZIP包后通过Magisk Manager安装
3. 重启设备生效
## 模式切换
```bash
# 1. 进入ADB shell（需要root权限）
adb shell
su

# 2. 执行845脚本并指定模式
845 [模式名称]

# 可用模式：
845 powersave    # 省电模式
845 balance      # 平衡模式（默认）
845 performance  # 性能模式
845 fast         # 极速模式
845 debug        # 调试模式（不启动后台进程）
```

## 注意事项
- **备份系统**：安装前建议使用TWRP等工具备份完整系统。
- **开发者警告**：关闭I/O统计和LMK日志可能影响系统问题的调试，请谨慎使用。
- **兼容性**：仅适用于搭载骁龙845处理器的MIUI设备，其他机型可能无法正常工作。
- **系统更新**：MIUI版本更新后可能需要重新安装模块或等待作者适配。
- **风险自负**：模块修改系统内核参数，使用前请自行评估风险。
